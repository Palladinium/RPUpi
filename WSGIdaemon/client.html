<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <script type="text/javascript">
    <!--
var xhr = new XMLHttpRequest();
// Use XMLHttpRequest (XHR) objects to interact with servers
// https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest
// The Document Object Model (DOM) connects web pages to scripts or programming languages
// https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model
// what is this callback maddness 
// http://recurial.com/programming/understanding-callback-functions-in-javascript/
xhr.responseType = 'text';

function onTest(url, callback) {
    "use strict";
    // set the callback to use when the wsgi daemon finishes.
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
            callback.call(xhr.responseText);
        }
    }

    xhr.open("GET", url, true);
    xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
    xhr.send(); 
}
    -->
    </script>
</head>

<body>

    <p id="wsgi_daemon"> abcdef </p>
     <button onclick="clickID()">/0/id?</button> 
    
<script>
function clickID() {
    "use strict";
    // if it turns red that is DOM based evidance that call was done
    document.getElementById("wsgi_daemon").style.color = 'yellow';
    onTest('http://127.0.0.1:8000/', function () {
        // pressent unamed callback gets this when it is called
        document.getElementById("wsgi_daemon").innerHTML = this;
        document.getElementById("wsgi_daemon").style.color = 'green';
    });
    document.getElementById("wsgi_daemon").style.color = 'red';
}
</script>

<p>The daemon complains about broken pipes after click or two and a direct access</p>
<pre>
127.0.0.1 - - [02/Oct/2018 20:05:26] "GET / HTTP/1.1" 200 99
127.0.0.1 - - [02/Oct/2018 20:05:26] "GET / HTTP/1.1" 200 99
127.0.0.1 - - [02/Oct/2018 20:05:27] "GET / HTTP/1.1" 200 99
127.0.0.1 - - [02/Oct/2018 20:05:58] "GET / HTTP/1.1" 200 99
127.0.0.1 - - [02/Oct/2018 20:05:59] "GET /favicon.ico HTTP/1.1" 200 99
127.0.0.1 - - [02/Oct/2018 20:05:59] "GET /favicon.ico HTTP/1.1" 200 99
Traceback (most recent call last):
  File "/usr/lib/python3.6/wsgiref/handlers.py", line 138, in run
    self.finish_response()
  File "/usr/lib/python3.6/wsgiref/handlers.py", line 180, in finish_response
    self.write(data)
  File "/usr/lib/python3.6/wsgiref/handlers.py", line 274, in write
    self.send_headers()
  File "/usr/lib/python3.6/wsgiref/handlers.py", line 332, in send_headers
    self.send_preamble()
  File "/usr/lib/python3.6/wsgiref/handlers.py", line 255, in send_preamble
    ('Date: %s\r\n' % format_date_time(time.time())).encode('iso-8859-1')
  File "/usr/lib/python3.6/wsgiref/handlers.py", line 453, in _write
    result = self.stdout.write(data)
  File "/usr/lib/python3.6/socketserver.py", line 800, in write
    self._sock.sendall(b)
BrokenPipeError: [Errno 32] Broken pipe
127.0.0.1 - - [02/Oct/2018 20:05:59] "GET /favicon.ico HTTP/1.1" 500 59
----------------------------------------
Exception happened during processing of request from ('127.0.0.1', 59038)
Traceback (most recent call last):
  File "/usr/lib/python3.6/wsgiref/handlers.py", line 138, in run
    self.finish_response()
  File "/usr/lib/python3.6/wsgiref/handlers.py", line 180, in finish_response
    self.write(data)
  File "/usr/lib/python3.6/wsgiref/handlers.py", line 274, in write
    self.send_headers()
  File "/usr/lib/python3.6/wsgiref/handlers.py", line 332, in send_headers
    self.send_preamble()
  File "/usr/lib/python3.6/wsgiref/handlers.py", line 255, in send_preamble
    ('Date: %s\r\n' % format_date_time(time.time())).encode('iso-8859-1')
  File "/usr/lib/python3.6/wsgiref/handlers.py", line 453, in _write
    result = self.stdout.write(data)
  File "/usr/lib/python3.6/socketserver.py", line 800, in write
    self._sock.sendall(b)
BrokenPipeError: [Errno 32] Broken pipe
</pre>
<p>I think I see what the problem is now</p>
<pre>
Failed to load http://127.0.0.1:8000/: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'null' is therefore not allowed access.
</pre>
<p>Basically, the browser does not want to accept the connection because it does not know if it is safe, yet it will open it directly. </p>

</body>

</html>
