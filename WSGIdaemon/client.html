<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <script type="text/javascript">
    <!--
var xhr = new XMLHttpRequest();
// Use XMLHttpRequest (XHR) objects to interact with servers
// https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest
// The Document Object Model (DOM) connects web pages to scripts or programming languages
// https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model
// what is this callback maddness 
// http://recurial.com/programming/understanding-callback-functions-in-javascript/
xhr.responseType = 'text';

function onTest(url, callback) {
    "use strict";
    // set the callback to use when the wsgi daemon finishes.
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
            callback.call(xhr.responseText);
        }
    }

    xhr.open("GET", url, true);
    xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
    xhr.send(); 
}
    -->
    </script>
</head>

<body>

    <p id="wsgi_daemon"> place_holder </p>
     <button onclick="clickID()">/0/id?</button> 
    
<script>
function clickID() {
    "use strict";
    // if it turns red that is DOM based evidance that call was done
    document.getElementById("wsgi_daemon").style.color = 'yellow';
    onTest('http://127.0.0.1:8000/', function () {
        // pressent unamed callback gets this when it is called
        document.getElementById("wsgi_daemon").innerHTML = this;
        document.getElementById("wsgi_daemon").style.color = 'green';
    });
    document.getElementById("wsgi_daemon").style.color = 'red';
}
</script>

<p>Modern web browsers have implemented the W3C standard Cross-Origin Resource Sharing (CORS) that allows the browser to have a same-origin policy. This policy means the browser will only allow callbacks from URL's inside a page that has the same origin (scope), that is they have identical schemes, hosts, and ports (RFC 6454).</p>
<p>When the callback fails the WSGI daemon will complain about a Broken pipe (e.g. the negotiated callback port did not accept input).</p>
<p>CORS can be turned off in Firefox with the <A HREF="https://github.com/spenibus/cors-everywhere-firefox-addon">cors-everywhere-firefox-addon</A> extension (which is for developer use)</p>

</body>

</html>
